##========== SOURCES ==========##

SRC =	builts-in/cd/cd_utils.c \
		builts-in/cd/cd.c \
		builts-in/export/export_print.c \
		builts-in/export/export_set.c \
		builts-in/echo.c \
		builts-in/env.c \
		builts-in/exit.c \
		builts-in/pwd.c \
		builts-in/unset.c \
		interpreter/execution/execution_utils.c \
		interpreter/execution/execution.c \
		interpreter/execution/fork.c \
		interpreter/execution/ifs.c \
		interpreter/execution/heredoc.c \
		interpreter/execution/pids.c \
		interpreter/execution/prepare_execution.c \
		interpreter/execution/update_inputs.c \
		interpreter/execution/update_outputs.c \
		interpreter/execution/fds.c \
		interpreter/expansion/expand.c \
		interpreter/expansion/expand_arg.c \
		interpreter/expansion/expand_utils.c \
		interpreter/expansion/wildcards.c \
		interpreter/expansion/wc_mask.c \
		interpreter/expansion/wc_sort.c \
		interpreter/parser/lexer.c \
		interpreter/parser/parse_cmd.c \
		interpreter/parser/parse_logex.c \
		interpreter/parser/parse_utils.c \
		utils/builts_in_utils.c \
		utils/create_nodes.c \
		utils/create_env.c \
		utils/print_node.c \
		utils/create_tokens.c \
		utils/tok_utils.c \
		utils/env_utils.c \
		utils/create_wc.c \
		utils/prompt.c \
		utils/str_utils.c \
		utils/signals.c

MAIN = minishell.c

##========== NAMES ==========##

NAME = minishell
SRCS_DIR = src/
OBJS_DIR = obj/
LIBFT_DIR = libft
INCLUDE_DIR = includes

##========== OBJECTS ==========##

OBJS = $(addprefix $(OBJS_DIR),$(SRC:.c=.o))
MAIN_OBJ = $(addprefix $(OBJS_DIR),$(MAIN:.c=.o))

##========== COLORS ==========##

BASE_COLOR 	=		\001\033[0;39m\002
GRAY 		=		\001\033[0;90m\002
RED 		=		\001\033[0;91m\002
GREEN 		=		\001\033[0;92m\002
YELLOW 		=		\001\033[0;93m\002
BLUE 		=		\001\033[0;94m\002
MAGENTA		=		\001\033[0;95m\002
CYAN 		=		\001\033[0;96m\002
WHITE		=		\001\033[0;97m\002

##========== COMPILATOR ==========##

CC = clang

##========== FLAGS ==========##

CFLAGS = -Wall -Wextra -Werror
LDFLAGS = $(LIBS)
LIBS = -I$(INCLUDE_DIR)
LIBFT = $(LIBFT_DIR)/libft.a
ARCHIVES =  $(PIPEX_DIR)/pipex.a $(LIBFT)

##========== MODES ==========##

TIMER = 0.0
IS_PRINT = 1

ifdef DEBUG
    CFLAGS += -g
	LDFLAGS += -D DEBUG=42
	DEBUG_MODE = 1
endif

ifdef FAST
	J4 = -j$(nproc)
endif

ifdef FSANITIZE
	LDFLAGS += -fsanitize=address
	FSANITIZE_MODE = 1
endif

##========== ANIMATIONS ==========##

NUM_SRC = $(words $(SRC))
INDEX = 0
START_TIME = $(shell date +%s)
NUMBER_OF_ANIMATION = 7
ifndef
	ANIMATION_RATE = 9
endif

define file_size_graph
	@awk -v size=$(shell stat -c %s $<) 'BEGIN { printf "[ "; for (i=0; i<int(size/1000); i++) printf "#"; printf " ] (%d KB)\n", size/1000 }'
endef

all : $(NAME)

$(NAME) : $(LIBFT) $(OBJS) $(MAIN_OBJ)
	@$(CC) -o $(NAME) $(CFLAGS) -lreadline $(MAIN_OBJ) $(OBJS) $(LDFLAGS) libft/libft.a
	@echo "$(GREEN)-= Minishell compiled =-$(BASE_COLOR)"
	@echo "$(BLUE)Compilation over in $(shell expr $(shell date +%s) - $(START_TIME)) seconds.$(BASE_COLOR)"

$(LIBFT) :
	@DEBUG=$(DEBUG_MODE) TIMER=$(TIMER) IS_PRINT=$(IS_PRINT) FSANITIZE=$(FSANITIZE_MODE) make -C $(LIBFT_DIR) --no-print-directory $(J4)

clean :
	@rm -rf $(OBJS_DIR)
	@$(MAKE) -C $(LIBFT_DIR) clean --no-print-directory

fclean : clean
	@rm -rf $(NAME)
	@$(MAKE) -C $(LIBFT_DIR) fclean --no-print-directory
	@echo "$(CYAN)Files cleaned$(BASE_COLOR)"

re : fclean all

$(OBJS_DIR)%.o : $(SRCS_DIR)%.c
ifeq ($(IS_PRINT), 1)
	@sleep $(TIMER)
	@clear
	$(animation_$(shell expr $(INDEX) / $(ANIMATION_RATE) % $(NUMBER_OF_ANIMATION)))
	$(loading)
	@mkdir -p $(dir $@)
	@echo "Compiling : $<"
	$(file_size_graph)
	$(CC) $(CFLAGS) $(LDFLAGS) -c $< -o $@
else
	@mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) $(LDFLAGS) -c $< -o $@
endif

define loading
	@echo "$(MAGENTA)Compiling Minishell$(BASE_COLOR)"
	@echo "╔══════════════════════════════════════════════╗"
	@echo -n "║$(MAGENTA)"
	@echo -n "▓"
	@for i in $$(seq 1 $$(expr $(INDEX) \* 45 / $(NUM_SRC))); do \
		echo -n "▓"; \
	done
	@for i in $$(seq 1 $$(expr 45 - $(INDEX) \* 45 / $(NUM_SRC))); do \
		echo -n " "; \
	done
	@echo "$(BASE_COLOR)║" $(shell expr $(INDEX) \* 100 / $(NUM_SRC))%
	@echo "╚══════════════════════════════════════════════╝"
	@$(eval INDEX=$(shell expr $(INDEX) + 1))
endef

define animation_0
	@echo -n "$(MAGENTA)"
	@echo '      ___           ___                       ___       ___           ___           ___           ___           ___           ___           ___           ___     '
	@echo '     /\  \         /\__\          ___        /\__\     /\  \         /\  \         /\  \         /\  \         /\__\         /\  \         /\  \         /\  \    '
	@echo '    /::\  \       /:/  /         /\  \      /:/  /    /::\  \       /::\  \       /::\  \       /::\  \       /:/  /        /::\  \       /::\  \       /::\  \   '
	@echo '   /:/\:\  \     /:/__/          \:\  \    /:/  /    /:/\:\  \     /:/\ \  \     /:/\:\  \     /:/\:\  \     /:/__/        /:/\:\  \     /:/\:\  \     /:/\ \  \  '
	@echo '  /::\~\:\  \   /::\  \ ___      /::\__\  /:/  /    /:/  \:\  \   _\:\~\ \  \   /:/  \:\  \   /::\~\:\  \   /::\  \ ___   /::\~\:\  \   /::\~\:\  \   _\:\~\ \  \ '
	@echo ' /:/\:\ \:\__\ /:/\:\  /\__\  __/:/\/__/ /:/__/    /:/__/ \:\__\ /\ \:\ \ \__\ /:/__/ \:\__\ /:/\:\ \:\__\ /:/\:\  /\__\ /:/\:\ \:\__\ /:/\:\ \:\__\ /\ \:\ \ \__\'
	@echo ' \/__\:\/:/  / \/__\:\/:/  / /\/:/  /    \:\  \    \:\  \ /:/  / \:\ \:\ \/__/ \:\  \ /:/  / \/__\:\/:/  / \/__\:\/:/  / \:\~\:\ \/__/ \/_|::\/:/  / \:\ \:\ \/__/'
	@echo '      \::/  /       \::/  /  \::/__/      \:\  \    \:\  /:/  /   \:\ \:\__\    \:\  /:/  /       \::/  /       \::/  /   \:\ \:\__\      |:|::/  /   \:\ \:\__\  '
	@echo '       \/__/        /:/  /    \:\__\       \:\  \    \:\/:/  /     \:\/:/  /     \:\/:/  /         \/__/        /:/  /     \:\ \/__/      |:|\/__/     \:\/:/  /  '
	@echo '                   /:/  /      \/__/        \:\__\    \::/  /       \::/  /       \::/  /                      /:/  /       \:\__\        |:|  |        \::/  /   '
	@echo '                   \/__/                     \/__/     \/__/         \/__/         \/__/                       \/__/         \/__/         \|__|         \/__/    '
	@echo -n "$(BASE_COLOR)"
endef

define animation_1
	@echo -n "$(MAGENTA)"
	@echo '                    ___                        ___       ___           ___           ___                         ___           ___           ___           ___     '
	@echo '      ___          /  /\           ___        /  /\     /  /\         /  /\         /  /\          ___          /  /\         /  /\         /  /\         /  /\    '
	@echo '     /  /\        /  /:/          /__/\      /  /:/    /  /::\       /  /::\       /  /::\        /  /\        /  /:/        /  /::\       /  /::\       /  /::\   '
	@echo '    /  /::\      /  /:/           \__\:\    /  /:/    /  /:/\:\     /__/:/\:\     /  /:/\:\      /  /::\      /  /:/        /  /:/\:\     /  /:/\:\     /__/:/\:\  '
	@echo '   /  /:/\:\    /  /::\ ___       /  /::\  /  /:/    /  /:/  \:\   _\_ \:\ \:\   /  /:/  \:\    /  /:/\:\    /  /::\ ___   /  /::\ \:\   /  /::\ \:\   _\_ \:\ \:\ '
	@echo '  /  /::\ \:\  /__/:/\:\  /\   __/  /:/\/ /__/:/    /__/:/ \__\:\ /__/\ \:\ \:\ /__/:/ \__\:\  /  /::\ \:\  /__/:/\:\  /\ /__/:/\:\ \:\ /__/:/\:\_\:\ /__/\ \:\ \:\'
	@echo ' /__/:/\:\_\:\ \__\/  \:\/:/  /__/\/:/~~  \  \:\    \  \:\ /  /:/ \  \:\ \:\_\/ \  \:\ /  /:/ /__/:/\:\_\:\ \__\/  \:\/:/ \  \:\ \:\_\/ \__\/~|::\/:/ \  \:\ \:\_\/'
	@echo ' \__\/  \:\/:/      \__\::/   \  \::/      \  \:\    \  \:\  /:/   \  \:\_\:\    \  \:\  /:/  \__\/  \:\/:/      \__\::/   \  \:\ \:\      |  |:|::/   \  \:\_\:\  '
	@echo '      \  \::/       /  /:/     \  \:\       \  \:\    \  \:\/:/     \  \:\/:/     \  \:\/:/        \  \::/       /  /:/     \  \:\_\/      |  |:|\/     \  \:\/:/  '
	@echo '       \__\/       /__/:/       \__\/        \  \:\    \  \::/       \  \::/       \  \::/          \__\/       /__/:/       \  \:\        |__|:|~       \  \::/   '
	@echo '                   \__\/                      \__\/     \__\/         \__\/         \__\/                       \__\/         \__\/         \__\|         \__\/    '
	@echo -n "$(BASE_COLOR)"
endef

define animation_2
	@echo -n "$(MAGENTA)"
	@echo '      ___         ___                                     ___           ___           ___           ___         ___           ___           ___           ___     '
	@echo '     /  /\       /__/\        ___                        /  /\         /  /\         /  /\         /  /\       /__/\         /  /\         /  /\         /  /\    '
	@echo '    /  /::\      \  \:\      /  /\                      /  /::\       /  /:/_       /  /::\       /  /::\      \  \:\       /  /:/_       /  /::\       /  /:/_   '
	@echo '   /  /:/\:\      \__\:\    /  /:/      ___     ___    /  /:/\:\     /  /:/ /\     /  /:/\:\     /  /:/\:\      \__\:\     /  /:/ /\     /  /:/\:\     /  /:/ /\  '
	@echo '  /  /:/~/:/  ___ /  /::\  /__/::\     /__/\   /  /\  /  /:/  \:\   /  /:/ /::\   /  /:/  \:\   /  /:/~/:/  ___ /  /::\   /  /:/ /:/_   /  /:/~/:/    /  /:/ /::\ '
	@echo ' /__/:/ /:/  /__/\  /:/\:\ \__\/\:\__  \  \:\ /  /:/ /__/:/ \__\:\ /__/:/ /:/\:\ /__/:/ \__\:\ /__/:/ /:/  /__/\  /:/\:\ /__/:/ /:/ /\ /__/:/ /:/___ /__/:/ /:/\:\'
	@echo ' \  \:\/:/   \  \:\/:/__\/    \  \:\/\  \  \:\  /:/  \  \:\ /  /:/ \  \:\/:/~/:/ \  \:\ /  /:/ \  \:\/:/   \  \:\/:/__\/ \  \:\/:/ /:/ \  \:\/:::::/ \  \:\/:/~/:/'
	@echo '  \  \::/     \  \::/          \__\::/   \  \:\/:/    \  \:\  /:/   \  \::/ /:/   \  \:\  /:/   \  \::/     \  \::/       \  \::/ /:/   \  \::/~~~~   \  \::/ /:/ '
	@echo '   \  \:\      \  \:\          /__/:/     \  \::/      \  \:\/:/     \__\/ /:/     \  \:\/:/     \  \:\      \  \:\        \  \:\/:/     \  \:\        \__\/ /:/  '
	@echo '    \  \:\      \  \:\         \__\/       \__\/        \  \::/        /__/:/       \  \::/       \  \:\      \  \:\        \  \::/       \  \:\         /__/:/   '
	@echo '     \__\/       \__\/                                   \__\/         \__\/         \__\/         \__\/       \__\/         \__\/         \__\/         \__\/    '
	@echo -n "$(BASE_COLOR)"
endef

define animation_3
	@echo -n "$(MAGENTA)"
	@echo '      ___         ___                                     ___           ___           ___           ___         ___           ___           ___           ___     '
	@echo '     /\  \       /\  \                                   /\  \         /\__\         /\  \         /\  \       /\  \         /\__\         /\  \         /\__\    '
	@echo '    /::\  \      \:\  \       ___                       /::\  \       /:/ _/_       /::\  \       /::\  \      \:\  \       /:/ _/_       /::\  \       /:/ _/_   '
	@echo '   /:/\:\__\      \:\  \     /\__\                     /:/\:\  \     /:/ /\  \     /:/\:\  \     /:/\:\__\      \:\  \     /:/ /\__\     /:/\:\__\     /:/ /\  \  '
	@echo '  /:/ /:/  /  ___ /::\  \   /:/__/      ___     ___   /:/  \:\  \   /:/ /::\  \   /:/  \:\  \   /:/ /:/  /  ___ /::\  \   /:/ /:/ _/_   /:/ /:/  /    /:/ /::\  \ '
	@echo ' /:/_/:/  /  /\  /:/\:\__\ /::\  \     /\  \   /\__\ /:/__/ \:\__\ /:/_/:/\:\__\ /:/__/ \:\__\ /:/_/:/  /  /\  /:/\:\__\ /:/_/:/ /\__\ /:/_/:/__/___ /:/_/:/\:\__\'
	@echo ' \:\/:/  /   \:\/:/  \/__/ \/\:\  \__  \:\  \ /:/  / \:\  \ /:/  / \:\/:/ /:/  / \:\  \ /:/  / \:\/:/  /   \:\/:/  \/__/ \:\/:/ /:/  / \:\/:::::/  / \:\/:/ /:/  /'
	@echo '  \::/__/     \::/__/       ~~\:\/\__\  \:\  /:/  /   \:\  /:/  /   \::/ /:/  /   \:\  /:/  /   \::/__/     \::/__/       \::/_/:/  /   \::/~~/~~~~   \::/ /:/  / '
	@echo '   \:\  \      \:\  \          \::/  /   \:\/:/  /     \:\/:/  /     \/_/:/  /     \:\/:/  /     \:\  \      \:\  \        \:\/:/  /     \:\~~\        \/_/:/  /  '
	@echo '    \:\__\      \:\__\         /:/  /     \::/  /       \::/  /        /:/  /       \::/  /       \:\__\      \:\__\        \::/  /       \:\__\         /:/  /   '
	@echo '     \/__/       \/__/         \/__/       \/__/         \/__/         \/__/         \/__/         \/__/       \/__/         \/__/         \/__/         \/__/    '
	@echo -n "$(BASE_COLOR)"
endef

define animation_4
	@echo -n "$(MAGENTA)"
	@echo " ______ _     _ _                       _                    "
	@echo " | ___ \ |   (_) |                     | |                   "
	@echo " | |_/ / |__  _| | ___  ___  ___  _ __ | |__   ___ _ __ ___  "
	@echo " |  __/| '_ \| | |/ _ \/ __|/ _ \| '_ \| '_ \ / _ \ '__/ __| "
	@echo " | |   | | | | | | (_) \__ \ (_) | |_) | | | |  __/ |  \__ \ "
	@echo " \_|   |_| |_|_|_|\___/|___/\___/| .__/|_| |_|\___|_|  |___/ "
	@echo "                                 | |                         "
	@echo "                                 |_|                         "
	@echo -n "$(BASE_COLOR)"
endef

define animation_5
	@echo -n "$(MAGENTA)"
	@echo " __________.__    .__.__                            .__                          "
	@echo " \______   \  |__ |__|  |   ____  __________ ______ |  |__   ___________  ______ "
	@echo "  |     ___/  |  \|  |  |  /  _ \/  ___/  _ \\____ \|  |  \_/ __ \_  __ \/  ___/ "
	@echo "  |    |   |   Y  \  |  |_(  <_> )___ (  <_> )  |_> >   Y  \  ___/|  | \/\___ \  "
	@echo "  |____|   |___|  /__|____/\____/____  >____/|   __/|___|  /\___  >__|  /____  > "
	@echo "                \/                   \/      |__|        \/     \/           \/  "
	@echo -n "$(BASE_COLOR)"
endef

define animation_6
	@echo -n "$(MAGENTA)"
	@echo '          _          _       _     _          _             _            _            _            _          _       _    _            _          _        '
	@echo '         /\ \       / /\    / /\  /\ \       _\ \          /\ \         / /\         /\ \         /\ \       / /\    / /\ /\ \         /\ \       / /\      '
	@echo '        /  \ \     / / /   / / /  \ \ \     /\__ \        /  \ \       / /  \       /  \ \       /  \ \     / / /   / / //  \ \       /  \ \     / /  \     '
	@echo '       / /\ \ \   / /_/   / / /   /\ \_\   / /_ \_\      / /\ \ \     / / /\ \__   / /\ \ \     / /\ \ \   / /_/   / / // /\ \ \     / /\ \ \   / / /\ \__  '
	@echo '      / / /\ \_\ / /\ \__/ / /   / /\/_/  / / /\/_/     / / /\ \ \   / / /\ \___\ / / /\ \ \   / / /\ \_\ / /\ \__/ / // / /\ \_\   / / /\ \_\ / / /\ \___\ '
	@echo '     / / /_/ / // /\ \___\/ /   / / /    / / /         / / /  \ \_\  \ \ \ \/___// / /  \ \_\ / / /_/ / // /\ \___\/ // /_/_ \/_/  / / /_/ / / \ \ \ \/___/ '
	@echo '    / / /__\/ // / /\/___/ /   / / /    / / /         / / /   / / /   \ \ \     / / /   / / // / /__\/ // / /\/___/ // /____/\    / / /__\/ /   \ \ \       '
	@echo '   / / /_____// / /   / / /   / / /    / / / ____    / / /   / / /_    \ \ \   / / /   / / // / /_____// / /   / / // /\____\/   / / /_____/_    \ \ \      '
	@echo '  / / /      / / /   / / /___/ / /__  / /_/_/ ___/\ / / /___/ / //_/\__/ / /  / / /___/ / // / /      / / /   / / // / /______  / / /\ \ \ /_/\__/ / /      '
	@echo ' / / /      / / /   / / //\__\/_/___\/_______/\__\// / /____\/ / \ \/___/ /  / / /____\/ // / /      / / /   / / // / /_______\/ / /  \ \ \\ \/___/ /       '
	@echo ' \/_/       \/_/    \/_/ \/_________/\_______\/    \/_________/   \_____\/   \/_________/ \/_/       \/_/    \/_/ \/__________/\/_/    \_\/ \_____\/        '
	@echo -n "$(BASE_COLOR)"
endef


define animation_7
	@echo -n "$(MAGENTA)"
	@echo ' __/\\\\\\\\\\\\\____/\\\________________/\\\\\\____________________________________________________________/\\\___________________________________________________         '
	@echo '  _\/\\\/////////\\\_\/\\\_______________\////\\\___________________________________________________________\/\\\___________________________________________________        '
	@echo '   _\/\\\_______\/\\\_\/\\\__________/\\\____\/\\\_______________________________________________/\\\\\\\\\__\/\\\___________________________________________________       '
	@echo '    _\/\\\\\\\\\\\\\/__\/\\\_________\///_____\/\\\________/\\\\\_____/\\\\\\\\\\_____/\\\\\_____/\\\/////\\\_\/\\\_____________/\\\\\\\\___/\\/\\\\\\\___/\\\\\\\\\\_      '
	@echo '     _\/\\\/////////____\/\\\\\\\\\\___/\\\____\/\\\______/\\\///\\\__\/\\\//////____/\\\///\\\__\/\\\\\\\\\\__\/\\\\\\\\\\____/\\\/////\\\_\/\\\/////\\\_\/\\\//////__     '
	@echo '      _\/\\\_____________\/\\\/////\\\_\/\\\____\/\\\_____/\\\__\//\\\_\/\\\\\\\\\\__/\\\__\//\\\_\/\\\//////___\/\\\/////\\\__/\\\\\\\\\\\__\/\\\___\///__\/\\\\\\\\\\_    '
	@echo '       _\/\\\_____________\/\\\___\/\\\_\/\\\____\/\\\____\//\\\__/\\\__\////////\\\_\//\\\__/\\\__\/\\\_________\/\\\___\/\\\_\//\\///////___\/\\\_________\////////\\\_   '
	@echo '        _\/\\\_____________\/\\\___\/\\\_\/\\\__/\\\\\\\\\__\///\\\\\/____/\\\\\\\\\\__\///\\\\\/___\/\\\_________\/\\\___\/\\\__\//\\\\\\\\\\_\/\\\__________/\\\\\\\\\\_  '
	@echo '         _\///______________\///____\///__\///__\/////////_____\/////_____\//////////_____\/////_____\///__________\///____\///____\//////////__\///__________\//////////__ '
	@echo -n "$(BASE_COLOR)"
endef

.PHONY : all clean fclean re